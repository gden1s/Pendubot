function dz = z_dot(z, y, u, th, L)
    dz = zeros(4, 1);
    g = th(6); b1 = th(7); b2 = th(8);
%     coeff = 1/(th(1)*th(2)-((th(3))^2)*((cos(y(2)))^2));
%     dz(1) = z(2);
%     dz(2) = coeff*(th(2)*u + th(2)*th(3)*sin(y(2))*(z(2))^2 + ...
%                      2*th(2)*th(3)*sin(y(2))*z(2)*z(4) + th(2)*th(3)*sin(y(2))*(z(4))^2 + ...
%                      ((th(3))^2)*sin(y(2))*cos(y(2))*(z(2))^2 - g*th(2)*th(4)*cos((y(1) - pi/2)) + ...
%                      g*th(3)*th(5)*cos(y(2))*cos((y(1) - pi/2) + y(2)) - ...
%                      th(2)*b1*z(2) + (th(2) + th(3)*cos(y(2)))*b2*z(4));
%     dz(3) = z(4);
%     dz(4) = coeff*(- th(2)*u - th(3)*cos(y(2))*u - ...
%                  th(1)*th(3)*sin(y(2))*(z(2))^2 - th(2)*th(3)*sin(y(2))*(z(2))^2 - ...
%                  th(2)*th(3)*sin(y(2))*(z(4))^2 - 2*th(2)*th(3)*sin(y(2))*z(2)*z(4) - ... 
%                  (th(3))^2*sin(y(2))*cos(y(2))*(2*(z(2))^2 + 2*z(2)*z(4) + (z(4))^2) - ...
%                  g*th(1)*th(5)*cos((y(1) - pi/2)+y(2)) + g*th(2)*th(4)*cos((y(1) - pi/2)) - ...
%                  g*th(3)*cos(y(2))*(th(5)*cos((y(1) - pi/2)+y(2)) - th(4)*cos((y(1) - pi/2))) + ...
%                  (th(2) + th(3)*cos(y(2)))*b1*z(2) - ...
%                  (th(1) + th(2) + 2*th(3)*cos(y(2)))*b2*z(4)); 
    coeff1 = 1/(th(1)*th(2)-((th(3))^2)*((cos(y(2)))^2));
    coeff2 = 1/(th(1)*th(2)-((th(3))^2)*((cos(z(3)))^2));
    dz(1) = z(2);
    dz(2) = coeff1*(th(2)*u - g*th(2)*th(4)*cos((y(1) - pi/2)) + ...
                     g*th(3)*th(5)*cos(y(2))*cos((y(1) - pi/2) + y(2))) + ...
            coeff2*(th(2)*th(3)*sin(z(3))*(z(2))^2 + ...
                     2*th(2)*th(3)*sin(z(3))*z(2)*z(4) + th(2)*th(3)*sin(z(3))*(z(4))^2 + ...
                     ((th(3))^2)*sin(z(3))*cos(z(3))*(z(2))^2 - ...
                     th(2)*b1*z(2) + (th(2) + th(3)*cos(z(3)))*b2*z(4));
    dz(3) = z(4);
    dz(4) = coeff1*(- th(2)*u - th(3)*cos(y(2))*u - ...
                 g*th(1)*th(5)*cos((y(1) - pi/2)+y(2)) + g*th(2)*th(4)*cos((y(1) - pi/2)) - ...
                 g*th(3)*cos(y(2))*(th(5)*cos((y(1) - pi/2)+y(2)) - th(4)*cos((y(1) - pi/2)))) + ...
            coeff2*(-th(1)*th(3)*sin(z(3))*(z(2))^2 - th(2)*th(3)*sin(z(3))*(z(2))^2 - ...
                 th(2)*th(3)*sin(z(3))*(z(4))^2 - 2*th(2)*th(3)*sin(z(3))*z(2)*z(4) - ... 
                 (th(3))^2*sin(z(3))*cos(z(3))*(2*(z(2))^2 + 2*z(2)*z(4) + (z(4))^2) + ...
                 (th(2) + th(3)*cos(z(3)))*b1*z(2) - ...
                 (th(1) + th(2) + 2*th(3)*cos(z(3)))*b2*z(4)); 
    dz = dz + L * (y - [z(1); z(3)]);
end